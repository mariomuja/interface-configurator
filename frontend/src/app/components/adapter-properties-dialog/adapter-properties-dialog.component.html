<h2 mat-dialog-title>
  <mat-icon>settings</mat-icon>
  {{ dialogTitle }}
</h2>

<mat-dialog-content>
  <div class="dialog-content">
    <mat-form-field appearance="outline" class="full-width compact-field">
      <mat-label>Instance Name</mat-label>
      <input matInput class="compact-input" [(ngModel)]="instanceName" placeholder="Enter instance name" />
      <mat-icon matSuffix matTooltip="A user-friendly name to identify this adapter instance. This name is displayed in the UI and helps distinguish between multiple instances of the same adapter type." matTooltipPosition="left">help_outline</mat-icon>
      <mat-hint class="compact-hint">A user-friendly name to identify this adapter instance</mat-hint>
    </mat-form-field>

    <!-- CSV Adapter Type Selection (Source only) -->
    <mat-form-field appearance="outline" class="full-width compact-field" *ngIf="showSftpProperties">
      <mat-label>Adapter Type</mat-label>
      <mat-select [(ngModel)]="csvAdapterType" class="compact-input">
        <mat-option value="RAW">RAW (Data in Property CsvData)</mat-option>
        <mat-option value="FILE">FILE (Azure Blob Storage)</mat-option>
        <mat-option value="SFTP">SFTP (SFTP Server)</mat-option>
      </mat-select>
      <mat-icon matSuffix matTooltip="Select the adapter type: RAW (data from CsvData property), FILE (Azure Blob Storage polling), or SFTP (SFTP server). RAW: Creates file from CsvData and moves to csv-incoming. FILE: Polls folder and copies files to csv-incoming. SFTP: Receives files via SFTP and moves to csv-incoming." matTooltipPosition="left">help_outline</mat-icon>
      <mat-hint class="compact-hint">Select the adapter type: RAW, FILE, or SFTP</mat-hint>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width compact-field" *ngIf="showReceiveFolder">
      <mat-label>Receive Folder</mat-label>
      <input matInput class="compact-input" [(ngModel)]="receiveFolder" placeholder="csv-files/csv-incoming" />
      <mat-icon matSuffix matTooltip="The blob storage folder path where CSV files are monitored. When a CSV file is added to this folder, it will be automatically processed. Format: 'container-name/folder-path' (e.g., 'csv-files/csv-incoming'). Leave empty to disable folder monitoring." matTooltipPosition="left">help_outline</mat-icon>
      <mat-hint class="compact-hint">Blob storage path for CSV files (e.g., "csv-files/csv-incoming")</mat-hint>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width compact-field" *ngIf="showFileMask">
      <mat-label>File Mask</mat-label>
      <input matInput class="compact-input" [(ngModel)]="fileMask" placeholder="*.txt" />
      <mat-icon matSuffix matTooltip="Wildcard pattern to filter files in the Receive Folder. Examples: '*.txt' (all .txt files), '*.csv' (all .csv files), 'data_*.txt' (files starting with 'data_' and ending with .txt). Supports * (any sequence) and ? (single character). Default: '*.txt'." matTooltipPosition="left">help_outline</mat-icon>
      <mat-hint class="compact-hint">File pattern filter (e.g., "*.txt", "*.csv", "data_*.txt")</mat-hint>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width compact-field" *ngIf="showBatchSize">
      <mat-label>Batch Size</mat-label>
      <input matInput class="compact-input" type="number" [(ngModel)]="batchSize" min="1" placeholder="100" />
      <mat-icon matSuffix matTooltip="Number of rows read from the CSV file in one chunk before debatching into single rows and writing to MessageBox. Larger batches improve performance for large files but use more memory. Smaller batches use less memory but may be slower. Default: 100 rows per batch." matTooltipPosition="left">help_outline</mat-icon>
      <mat-hint class="compact-hint">Number of rows per batch (default: 100)</mat-hint>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width compact-field" *ngIf="showFieldSeparator">
      <mat-label>Field Separator</mat-label>
      <input matInput class="compact-input" [(ngModel)]="fieldSeparator" placeholder="║" maxlength="10" />
      <mat-icon matSuffix matTooltip="Character used to separate fields in CSV files. Used when reading/validating CSV rows and when constructing new CSV files as destination. Default: '║' (Box Drawing Double Vertical Line, U+2551) - a seldomly used UTF-8 character that avoids conflicts with common data." matTooltipPosition="left">help_outline</mat-icon>
      <mat-hint class="compact-hint">Field separator character (default: ║)</mat-hint>
    </mat-form-field>

    <!-- CSV Destination Properties (only when used as destination) -->
    <div *ngIf="showDestinationProperties" class="csv-destination-section">
      <h3>CSV Destination Configuration</h3>

      <mat-form-field appearance="outline" class="full-width compact-field">
        <mat-label>Destination Receive Folder</mat-label>
        <input matInput class="compact-input" [(ngModel)]="destinationReceiveFolder" placeholder="csv-files/csv-outgoing" />
        <mat-icon matSuffix matTooltip="The blob storage folder path where CSV files will be written. Files will be created in this folder with filenames constructed from the Destination File Mask pattern. Format: 'container-name/folder-path' (e.g., 'csv-files/csv-outgoing')." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">Blob storage path for output CSV files (e.g., "csv-files/csv-outgoing")</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width compact-field">
        <mat-label>Destination File Mask</mat-label>
        <input matInput class="compact-input" [(ngModel)]="destinationFileMask" placeholder="output_$datetime.txt" />
        <mat-icon matSuffix matTooltip="File mask pattern for constructing output filenames. Supports variables: $datetime (replaced with current date/time with milliseconds: yyyyMMddHHmmss.fff). Example: 'text_' + $datetime + '.txt' becomes 'text_20240101120000.123.txt'. Wildcards (*, ?) are also supported and will be replaced with datetime." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">File pattern with variables (e.g., "output_$datetime.txt", "data_*.csv")</mat-hint>
      </mat-form-field>
    </div>

    <!-- SQL Server Connection Properties -->
    <div *ngIf="showSqlServerProperties" class="sql-section">
      <h3>SQL Server Connection</h3>

      <mat-form-field appearance="outline" class="full-width compact-field">
        <mat-label>Server Name</mat-label>
        <input matInput class="compact-input" [(ngModel)]="sqlServerName" (ngModelChange)="onSqlPropertyChange()" placeholder="sql-server.database.windows.net" />
        <mat-icon matSuffix matTooltip="SQL Server name or IP address. For Azure SQL: use the full FQDN (e.g., 'sql-server.database.windows.net'). For on-premises: use server name or IP address (e.g., '192.168.1.100' or 'localhost')." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">SQL Server name or IP (e.g., "sql-server.database.windows.net")</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width compact-field">
        <mat-label>Database Name</mat-label>
        <input matInput class="compact-input" [(ngModel)]="sqlDatabaseName" (ngModelChange)="onSqlPropertyChange()" placeholder="MyDatabase" />
        <mat-icon matSuffix matTooltip="The name of the SQL Server database to connect to." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">Database name</mat-hint>
      </mat-form-field>

      <!-- Table Name (only for Destination adapters) -->
      <mat-form-field appearance="outline" class="full-width compact-field" *ngIf="data.adapterType === 'Destination'">
        <mat-label>Table Name</mat-label>
        <input matInput class="compact-input" [(ngModel)]="tableName" placeholder="TransportData" />
        <mat-icon matSuffix matTooltip="The name of the destination table in the SQL Server database. The table will be automatically created with dynamic columns based on the CSV data structure." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">Destination table name (e.g., "TransportData")</mat-hint>
      </mat-form-field>

      <div class="toggle-container compact-toggle">
        <div class="toggle-header">
          <mat-slide-toggle [(ngModel)]="sqlIntegratedSecurity" (ngModelChange)="onSqlPropertyChange()" color="primary">
            <span class="toggle-label normal-font">Integrated Security (Windows Authentication)</span>
          </mat-slide-toggle>
          <mat-icon class="help-icon" matTooltip="Use Windows Authentication (Integrated Security). When enabled, User Name and Password are not required. When disabled, SQL Authentication is used with User Name and Password." matTooltipPosition="right">help_outline</mat-icon>
        </div>
      </div>

      <mat-form-field appearance="outline" class="full-width compact-field" *ngIf="!sqlIntegratedSecurity">
        <mat-label>User Name</mat-label>
        <input matInput class="compact-input" [(ngModel)]="sqlUserName" (ngModelChange)="onSqlPropertyChange()" placeholder="sql_admin" />
        <mat-icon matSuffix matTooltip="SQL login username (required when Integrated Security is disabled)." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">SQL login username</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width compact-field" *ngIf="!sqlIntegratedSecurity">
        <mat-label>Password</mat-label>
        <input matInput class="compact-input" type="password" [(ngModel)]="sqlPassword" (ngModelChange)="onSqlPropertyChange()" placeholder="••••••••" />
        <mat-icon matSuffix matTooltip="SQL login password (required when Integrated Security is disabled)." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">SQL login password</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width compact-field">
        <mat-label>Resource Group</mat-label>
        <input matInput class="compact-input" [(ngModel)]="sqlResourceGroup" (ngModelChange)="onSqlPropertyChange()" placeholder="rg-my-resource-group" />
        <mat-icon matSuffix matTooltip="Azure Resource Group name (for Azure SQL managed database access). Used for Azure-specific security and access management." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">Azure Resource Group (optional, for Azure SQL)</mat-hint>
      </mat-form-field>

      <!-- Connection String Display -->
      <mat-form-field appearance="outline" class="full-width compact-field" *ngIf="connectionString">
        <mat-label>Connection String</mat-label>
        <input matInput class="compact-input" [value]="connectionString" readonly />
        <button mat-icon-button matSuffix (click)="copyConnectionString()" matTooltip="Copy connection string to clipboard">
          <mat-icon>content_copy</mat-icon>
        </button>
        <mat-icon matSuffix matTooltip="The generated connection string based on the SQL Server properties above. Click the copy button to copy it to clipboard." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">Generated connection string (read-only)</mat-hint>
      </mat-form-field>

      <!-- Transaction and Batch Size Properties -->
      <div class="toggle-container compact-toggle">
        <div class="toggle-header">
          <mat-slide-toggle [(ngModel)]="sqlUseTransaction" color="primary">
            <span class="toggle-label normal-font">Use Transaction</span>
          </mat-slide-toggle>
          <mat-icon class="help-icon" matTooltip="Wrap execution in an explicit SQL transaction. When enabled, all database operations are wrapped in a transaction that can be committed or rolled back. This ensures atomicity - either all operations succeed or all are rolled back on error." matTooltipPosition="right">help_outline</mat-icon>
        </div>
      </div>

      <mat-form-field appearance="outline" class="full-width compact-field">
        <mat-label>Batch Size</mat-label>
        <input matInput class="compact-input" type="number" [(ngModel)]="sqlBatchSize" min="1" placeholder="1000" />
        <mat-icon matSuffix matTooltip="Number of rows fetched at once when reading data from SQL Server. Larger batch sizes improve performance for large result sets but use more memory. Smaller batch sizes use less memory but may be slower. Default: 1000 rows per batch." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">Number of rows per batch (default: 1000)</mat-hint>
      </mat-form-field>
    </div>

    <!-- RAW Properties (Source only, when RAW adapter type) -->
    <div *ngIf="showRawProperties" class="raw-section">
      <h3>RAW Data Configuration</h3>
      
      <mat-form-field appearance="outline" class="full-width compact-field">
        <mat-label>CSV Data</mat-label>
        <textarea matInput class="compact-input" [(ngModel)]="csvData" rows="6" placeholder="id║name║email&#10;1║John Doe║john@example.com&#10;2║Jane Smith║jane@example.com"></textarea>
        <mat-icon matSuffix matTooltip="CSV data content. When adapter type is RAW, this data will be written to a file and moved to csv-incoming folder for processing. Use the configured field separator (default: ║) to separate columns." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">Enter CSV data with headers and rows, separated by the field separator (default: ║)</mat-hint>
      </mat-form-field>
    </div>

    <!-- SFTP Properties (Source only, when SFTP adapter type) -->
    <div *ngIf="showSftpProperties && csvAdapterType === 'SFTP'" class="sftp-section">
      <h3>SFTP Configuration</h3>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Host</mat-label>
        <input matInput [(ngModel)]="sftpHost" placeholder="sftp.example.com" />
        <mat-icon matSuffix matTooltip="SFTP server hostname or IP address." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint>SFTP server hostname or IP</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Port</mat-label>
        <input matInput type="number" [(ngModel)]="sftpPort" min="1" max="65535" placeholder="22" />
        <mat-icon matSuffix matTooltip="SFTP server port (default: 22)." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint>SFTP server port (default: 22)</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Username</mat-label>
        <input matInput [(ngModel)]="sftpUsername" placeholder="sftp_user" />
        <mat-icon matSuffix matTooltip="SFTP username for authentication." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint>SFTP username</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Password</mat-label>
        <input matInput type="password" [(ngModel)]="sftpPassword" placeholder="••••••••" />
        <mat-icon matSuffix matTooltip="SFTP password for authentication (alternative to SSH Key)." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint>SFTP password (or use SSH Key below)</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>SSH Key (Base64)</mat-label>
        <textarea matInput [(ngModel)]="sftpSshKey" rows="4" placeholder="-----BEGIN RSA PRIVATE KEY-----..."></textarea>
        <mat-icon matSuffix matTooltip="SFTP SSH private key in Base64 format (alternative to Password). Paste the Base64-encoded private key content here." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint>Base64-encoded SSH private key (or use Password above)</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Folder</mat-label>
        <input matInput [(ngModel)]="sftpFolder" placeholder="/remote/folder/path" />
        <mat-icon matSuffix matTooltip="SFTP remote folder path where CSV files are located." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint>SFTP remote folder path (e.g., "/data/csv")</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>File Mask</mat-label>
        <input matInput [(ngModel)]="sftpFileMask" placeholder="*.txt" />
        <mat-icon matSuffix matTooltip="File mask pattern to filter files in the SFTP folder. Examples: '*.txt' (all .txt files), '*.csv' (all .csv files), 'data_*.txt' (files starting with 'data_' and ending with .txt). Supports * (any sequence) and ? (single character). Default: '*.txt'." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint>File pattern filter (e.g., "*.txt", "*.csv", "data_*.txt")</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Max Connection Pool Size</mat-label>
        <input matInput type="number" [(ngModel)]="sftpMaxConnectionPoolSize" min="1" placeholder="5" />
        <mat-icon matSuffix matTooltip="Maximum number of concurrent SFTP connections in the connection pool. Larger pool sizes improve performance for concurrent operations but use more resources. Default: 5." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint>Maximum concurrent connections (default: 5)</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>File Buffer Size (bytes)</mat-label>
        <input matInput type="number" [(ngModel)]="sftpFileBufferSize" min="1024" placeholder="8192" />
        <mat-icon matSuffix matTooltip="Buffer size in bytes for reading files from SFTP server. Larger buffer sizes improve performance but use more memory. Default: 8192 bytes (8 KB)." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint>Buffer size in bytes (default: 8192)</mat-hint>
      </mat-form-field>
    </div>

    <!-- SQL Server Polling Properties (Source only) -->
    <div *ngIf="showSqlPollingProperties" class="sql-section">
      <h3>Polling Configuration (Source Only)</h3>

      <mat-form-field appearance="outline" class="full-width compact-field">
        <mat-label>Table Name</mat-label>
        <input matInput class="compact-input" [(ngModel)]="tableName" placeholder="TransportData" />
        <mat-icon matSuffix matTooltip="Table name for SQL Server adapter. Used in default PollingStatement if PollingStatement is not provided (default: 'SELECT * FROM Table')." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">Table name (e.g., "TransportData")</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width compact-field">
        <mat-label>Polling Statement</mat-label>
        <textarea matInput class="compact-input" [(ngModel)]="sqlPollingStatement" rows="2" placeholder="SELECT * FROM Orders WHERE Processed = 0"></textarea>
        <mat-icon matSuffix matTooltip="SQL SELECT or EXEC statement to poll for new data. This statement is executed periodically according to the Polling Interval. Example: 'SELECT * FROM Orders WHERE Processed = 0' or 'EXEC sp_GetNewOrders'. The results are debatched and written to MessageBox." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">SQL SELECT or EXEC statement (e.g., "SELECT * FROM Orders WHERE Processed = 0")</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width compact-field">
        <mat-label>Polling Interval</mat-label>
        <input matInput class="compact-input" type="number" [(ngModel)]="sqlPollingInterval" min="1" placeholder="60" />
        <mat-icon matSuffix matTooltip="How often the polling statement is executed (in seconds). The adapter will run the polling statement at this interval to check for new data. Default: 60 seconds." matTooltipPosition="left">help_outline</mat-icon>
        <mat-hint class="compact-hint">Polling interval in seconds (default: 60)</mat-hint>
      </mat-form-field>
    </div>

    <div class="toggle-container compact-toggle">
      <div class="toggle-header">
        <mat-slide-toggle [(ngModel)]="isEnabled" color="primary">
          <span class="toggle-label normal-font">Enabled</span>
        </mat-slide-toggle>
        <mat-icon class="help-icon" matTooltip="Controls whether this adapter instance is active. When enabled, the adapter process runs automatically according to its schedule. When disabled, the process stops immediately and no data will be processed." matTooltipPosition="right">help_outline</mat-icon>
      </div>
    </div>

    <div class="guid-info" *ngIf="adapterInstanceGuid">
      <mat-icon>fingerprint</mat-icon>
      <div class="guid-text-container">
        <span class="guid-label">
          Adapter Instance GUID:
          <mat-icon class="help-icon" matTooltip="A unique identifier (GUID) assigned to this adapter instance. This GUID is used internally to track which adapter instance created each message in the MessageBox. It ensures proper message routing and traceability." matTooltipPosition="right">help_outline</mat-icon>
        </span>
        <span class="guid-value">{{ adapterInstanceGuid }}</span>
      </div>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()" color="warn">Cancel</button>
  <button mat-raised-button (click)="onSave()" color="primary">
    <mat-icon>save</mat-icon>
    Save
  </button>
</mat-dialog-actions>

