<mat-expansion-panel [(expanded)]="expanded" (opened)="onExpandedChange(true)" (closed)="onExpandedChange(false)" 
                     [class]="'data-card ' + (adapterName === 'CSV' ? 'csv-card' : 'sql-card')"
                     [class.disabled-card]="isDisabled"
                     [disabled]="isDisabled">
  <mat-expansion-panel-header>
    <mat-panel-title>
      <div class="card-header-left">
        <mat-icon class="expand-icon">
          {{ expanded ? 'expand_less' : 'expand_more' }}
        </mat-icon>
        
        <button mat-icon-button (click)="onSettings(); $event.stopPropagation()" 
                class="settings-button" 
                [disabled]="isDisabled"
                matTooltip="Adapter-Eigenschaften öffnen">
          <mat-icon>settings</mat-icon>
        </button>
        
        <button mat-icon-button (click)="onRestart(); $event.stopPropagation()" 
                [disabled]="isRestarting || isDisabled" 
                class="restart-button" 
                matTooltip="Adapter-Prozess neu starten">
          <mat-icon>{{ isRestarting ? 'hourglass_empty' : 'refresh' }}</mat-icon>
        </button>
        
        <div class="instance-name-display">
          <span class="instance-name-text">{{ instanceName || (adapterType === 'Source' ? 'Source' : 'Destination') }}</span>
          <mat-icon *ngIf="isDisabled && adapterType === 'Destination' && adapterName === 'SqlServer'" class="warning-icon" 
                    matTooltip="Die Zieltabelle existiert nicht. Beim nächsten CSV-Upload wird die Tabelle mit den CSV-Spalten automatisch neu erstellt.">
            info
          </mat-icon>
        </div>
        
        <!-- Enabled toggle for destination adapters -->
        <mat-slide-toggle *ngIf="adapterType === 'Destination'" 
                          [(ngModel)]="isEnabled" 
                          (ngModelChange)="onEnabledChange()"
                          color="primary"
                          [disabled]="isDisabled"
                          matTooltip="Enable or disable this destination adapter instance">
        </mat-slide-toggle>
        
        <div class="guid-display" *ngIf="adapterInstanceGuid" matTooltip="Adapter Instance GUID: {{ adapterInstanceGuid }}">
          <mat-icon>fingerprint</mat-icon>
          <span class="guid-text">{{ adapterInstanceGuid.substring(0, 8) }}...</span>
        </div>
      </div>
    </mat-panel-title>
    <mat-panel-description *ngIf="adapterType === 'Destination'">
      <button mat-raised-button [color]="getPrimaryActionColor()" 
              (click)="onPrimaryAction(); $event.stopPropagation()" 
              [disabled]="isDisabled || primaryActionDisabled"
              class="action-button">
        <mat-icon>{{ getPrimaryActionIcon() }}</mat-icon>
        {{ getPrimaryActionLabel() }}
      </button>
    </mat-panel-description>
  </mat-expansion-panel-header>
  
  <div *ngIf="isLoading" class="spinner-container">
    <mat-spinner></mat-spinner>
  </div>
  
  <!-- CSV Data Display (for CSV Source adapters) -->
  <div class="csv-text-container" *ngIf="!isLoading && adapterName === 'CSV' && adapterType === 'Source'">
    <div 
      #csvEditor
      class="csv-text csv-editable" 
      contenteditable="true"
      (input)="onCsvDataInput($event)"
      (blur)="onCsvDataBlur()"
      spellcheck="false"
      [attr.data-placeholder]="'CSV-Daten hier bearbeiten...'"></div>
  </div>
  
  <ng-content></ng-content>
</mat-expansion-panel>

