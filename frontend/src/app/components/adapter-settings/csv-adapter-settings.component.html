<div class="csv-settings-grid">
<!-- CSV Adapter Type Selection (Source only) -->
<mat-form-field appearance="outline" class="compact-field" *ngIf="adapterType === 'Source'" floatLabel="always" style="grid-column: 1 / -1;">
  <mat-label>Adapter Type</mat-label>
  <mat-select [(ngModel)]="csvAdapterType" class="compact-input">
    <mat-option value="RAW">RAW (Data in Property CsvData)</mat-option>
    <mat-option value="FILE">FILE (Azure Blob Storage)</mat-option>
    <mat-option value="SFTP">SFTP (SFTP Server)</mat-option>
  </mat-select>
  <mat-icon matSuffix matTooltip="Select the adapter type: RAW (data from CsvData property), FILE (Azure Blob Storage polling), or SFTP (SFTP server). RAW: Creates file from CsvData and moves to csv-incoming. FILE: Polls folder and copies files to csv-incoming. SFTP: Receives files via SFTP and moves to csv-incoming." matTooltipPosition="left">help_outline</mat-icon>
</mat-form-field>

<mat-form-field appearance="outline" class="compact-field" *ngIf="showReceiveFolder" floatLabel="always">
  <mat-label>Receive Folder</mat-label>
  <input matInput class="compact-input" [(ngModel)]="receiveFolder" />
  <mat-icon matSuffix matTooltip="The blob storage folder path where CSV files are monitored. When a CSV file is added to this folder, it will be automatically processed. Format: 'container-name/folder-path' (e.g., 'csv-files/csv-incoming'). Leave empty to disable folder monitoring." matTooltipPosition="left">help_outline</mat-icon>
</mat-form-field>

<mat-form-field appearance="outline" class="compact-field" *ngIf="showFileMask" floatLabel="always">
  <mat-label>File Mask</mat-label>
  <input matInput class="compact-input" [(ngModel)]="fileMask" />
  <mat-icon matSuffix matTooltip="File name pattern to match when polling for CSV files. Supports wildcards: * (any characters) and ? (single character). Examples: '*.csv', 'data_*.txt', 'file??.csv'. Default: '*.txt'." matTooltipPosition="left">help_outline</mat-icon>
</mat-form-field>

<mat-form-field appearance="outline" class="compact-field" floatLabel="always">
  <mat-label>Batch Size</mat-label>
  <input matInput class="compact-input" type="number" [(ngModel)]="batchSize" min="1" />
  <mat-icon matSuffix matTooltip="Number of rows read from the CSV file in one chunk before debatching into single rows and writing to MessageBox. Larger batches improve performance for large files but use more memory. Smaller batches use less memory but may be slower. Default: 100 rows per batch." matTooltipPosition="left">help_outline</mat-icon>
</mat-form-field>

<mat-form-field appearance="outline" class="compact-field" *ngIf="adapterType === 'Source'" floatLabel="always">
  <mat-label>Polling Interval (seconds)</mat-label>
  <input matInput class="compact-input" type="number" [(ngModel)]="csvPollingInterval" min="1" />
  <mat-icon matSuffix matTooltip="Defines how often this CSV adapter checks for new data. RAW: controls how often CsvData is inspected for changes. FILE/SFTP: controls how often the adapter polls the folder or SFTP server for new files. Default: 10 seconds." matTooltipPosition="left">help_outline</mat-icon>
</mat-form-field>

<mat-form-field appearance="outline" class="compact-field" *ngIf="adapterType === 'Source' && (csvAdapterType === 'FILE' || csvAdapterType === 'SFTP')" floatLabel="always">
  <mat-label>Skip Header Lines</mat-label>
  <input matInput class="compact-input" type="number" [(ngModel)]="csvSkipHeaderLines" min="0" />
  <mat-icon matSuffix matTooltip="Number of lines to skip at the beginning of CSV files (e.g., header lines, comments). These lines will be removed before processing. Default: 0 (no lines skipped)." matTooltipPosition="left">help_outline</mat-icon>
</mat-form-field>

<mat-form-field appearance="outline" class="compact-field" *ngIf="adapterType === 'Source' && (csvAdapterType === 'FILE' || csvAdapterType === 'SFTP')" floatLabel="always">
  <mat-label>Skip Footer Lines</mat-label>
  <input matInput class="compact-input" type="number" [(ngModel)]="csvSkipFooterLines" min="0" />
  <mat-icon matSuffix matTooltip="Number of lines to skip at the end of CSV files (e.g., summary rows, totals). These lines will be removed before processing. Default: 0 (no lines skipped)." matTooltipPosition="left">help_outline</mat-icon>
</mat-form-field>

<mat-form-field appearance="outline" class="compact-field" *ngIf="adapterType === 'Source' && (csvAdapterType === 'FILE' || csvAdapterType === 'SFTP')" floatLabel="always">
  <mat-label>Quote Character</mat-label>
  <input matInput class="compact-input" [(ngModel)]="csvQuoteCharacter" maxlength="1" />
  <mat-icon matSuffix matTooltip="Character used to enclose CSV values (e.g., &quot; for double quotes, ' for single quotes). Leave empty if CSV values are not quoted. Default: &quot; (double quote)." matTooltipPosition="left">help_outline</mat-icon>
</mat-form-field>

<mat-form-field appearance="outline" class="compact-field" *ngIf="adapterType === 'Destination'" floatLabel="always">
  <mat-label>Field Separator</mat-label>
  <input matInput class="compact-input" [(ngModel)]="fieldSeparator" maxlength="10" />
  <mat-icon matSuffix matTooltip="UTF character used when data from MessageBox is serialized into CSV rows for this destination. Choose a rarely used character to avoid conflicts in the generated output. Default: 'â•‘' (Box Drawing Double Vertical Line, U+2551)." matTooltipPosition="left">help_outline</mat-icon>
</mat-form-field>
</div>

<!-- CSV Destination Properties (only when used as destination) -->
<div *ngIf="showDestinationProperties" class="csv-destination-section">
  <h3 style="grid-column: 1 / -1;">CSV Destination Configuration</h3>
  
  <mat-form-field appearance="outline" class="compact-field" floatLabel="always">
    <mat-label>Destination Receive Folder</mat-label>
    <input matInput class="compact-input" [(ngModel)]="destinationReceiveFolder" />
    <mat-icon matSuffix matTooltip="The blob storage folder path where CSV files will be written. Files will be created in this folder with filenames constructed from the Destination File Mask pattern. Format: 'container-name/folder-path' (e.g., 'csv-files/csv-outgoing')." matTooltipPosition="left">help_outline</mat-icon>
  </mat-form-field>

  <mat-form-field appearance="outline" class="compact-field" floatLabel="always">
    <mat-label>Destination File Mask</mat-label>
    <input matInput class="compact-input" [(ngModel)]="destinationFileMask" />
    <mat-icon matSuffix matTooltip="File name pattern for generated CSV files. Supports wildcards and date/time placeholders: * (any characters), ? (single character), {datetime} (current date/time). Examples: 'output_*.csv', 'data_{datetime}.txt'. Default: '*.txt'." matTooltipPosition="left">help_outline</mat-icon>
  </mat-form-field>
</div>

<!-- SFTP Properties -->
<div *ngIf="showSftpProperties" class="sftp-section">
  <h3 style="grid-column: 1 / -1;">SFTP Configuration</h3>
  
  <mat-form-field appearance="outline" class="compact-field" floatLabel="always">
    <mat-label>SFTP Host</mat-label>
    <input matInput class="compact-input" [(ngModel)]="sftpHost" />
    <mat-icon matSuffix matTooltip="SFTP server hostname or IP address." matTooltipPosition="left">help_outline</mat-icon>
  </mat-form-field>

  <mat-form-field appearance="outline" class="compact-field" floatLabel="always">
    <mat-label>SFTP Port</mat-label>
    <input matInput class="compact-input" type="number" [(ngModel)]="sftpPort" min="1" max="65535" />
    <mat-icon matSuffix matTooltip="SFTP server port number. Default: 22." matTooltipPosition="left">help_outline</mat-icon>
  </mat-form-field>

  <mat-form-field appearance="outline" class="compact-field" floatLabel="always">
    <mat-label>SFTP Username</mat-label>
    <input matInput class="compact-input" [(ngModel)]="sftpUsername" />
    <mat-icon matSuffix matTooltip="Username for SFTP authentication." matTooltipPosition="left">help_outline</mat-icon>
  </mat-form-field>

  <mat-form-field appearance="outline" class="compact-field" floatLabel="always">
    <mat-label>SFTP Password</mat-label>
    <input matInput class="compact-input" type="password" [(ngModel)]="sftpPassword" />
    <mat-icon matSuffix matTooltip="Password for SFTP authentication. Alternatively, use SSH Key." matTooltipPosition="left">help_outline</mat-icon>
  </mat-form-field>

  <mat-form-field appearance="outline" class="compact-field" floatLabel="always" style="grid-column: 1 / -1;">
    <mat-label>SFTP SSH Key (optional)</mat-label>
    <textarea matInput class="compact-input" [(ngModel)]="sftpSshKey" rows="4" placeholder="Paste SSH private key here..."></textarea>
    <mat-icon matSuffix matTooltip="SSH private key for SFTP authentication. Use this instead of password for key-based authentication." matTooltipPosition="left">help_outline</mat-icon>
  </mat-form-field>

  <mat-form-field appearance="outline" class="compact-field" floatLabel="always">
    <mat-label>SFTP Folder</mat-label>
    <input matInput class="compact-input" [(ngModel)]="sftpFolder" />
    <mat-icon matSuffix matTooltip="SFTP remote folder path where CSV files are located." matTooltipPosition="left">help_outline</mat-icon>
  </mat-form-field>

  <mat-form-field appearance="outline" class="compact-field" floatLabel="always">
    <mat-label>SFTP File Mask</mat-label>
    <input matInput class="compact-input" [(ngModel)]="sftpFileMask" />
    <mat-icon matSuffix matTooltip="File name pattern to match when polling SFTP server for CSV files. Supports wildcards: * and ?. Default: '*.txt'." matTooltipPosition="left">help_outline</mat-icon>
  </mat-form-field>

  <mat-form-field appearance="outline" class="compact-field" floatLabel="always">
    <mat-label>Max Connection Pool Size</mat-label>
    <input matInput class="compact-input" type="number" [(ngModel)]="sftpMaxConnectionPoolSize" min="1" />
    <mat-icon matSuffix matTooltip="Maximum number of concurrent SFTP connections in the connection pool. Default: 5." matTooltipPosition="left">help_outline</mat-icon>
  </mat-form-field>

  <mat-form-field appearance="outline" class="compact-field" floatLabel="always">
    <mat-label>File Buffer Size (bytes)</mat-label>
    <input matInput class="compact-input" type="number" [(ngModel)]="sftpFileBufferSize" min="1024" />
    <mat-icon matSuffix matTooltip="Buffer size in bytes for reading files from SFTP server. Larger buffer sizes improve performance but use more memory. Default: 8192 bytes (8 KB)." matTooltipPosition="left">help_outline</mat-icon>
  </mat-form-field>
</div>

