version: "3.8"

services:
  jenkins:
    image: jenkins/jenkins:lts-jdk17
    container_name: interface-configurator-jenkins
    ports:
      - "8080:8080"
      - "50000:50000"
    environment:
      # Git credentials for multibranch job (werden aus lokaler .env gelesen, nicht ins Git einchecken!)
      - GIT_USERNAME=${GIT_USERNAME}
      - GIT_PASSWORD=${GIT_PASSWORD}
      # Azure Service Principal + Subscription (Deploy + Tests)
      - AZURE_CLIENT_ID=${AZURE_CLIENT_ID}
      - AZURE_CLIENT_SECRET=${AZURE_CLIENT_SECRET}
      - AZURE_TENANT_ID=${AZURE_TENANT_ID}
      - AZURE_SUBSCRIPTION_ID=${AZURE_SUBSCRIPTION_ID}
      # Function App / HTTP Tests
      - AZURE_FUNCTION_APP_NAME=${AZURE_FUNCTION_APP_NAME}
      - AZURE_RESOURCE_GROUP=${AZURE_RESOURCE_GROUP}
      # SQL Server Integration Tests
      - AZURE_SQL_SERVER=${AZURE_SQL_SERVER}
      - AZURE_SQL_DATABASE=${AZURE_SQL_DATABASE}
      - AZURE_SQL_USER=${AZURE_SQL_USER}
      - AZURE_SQL_PASSWORD=${AZURE_SQL_PASSWORD}
      # Service Bus Tests
      - AZURE_SERVICE_BUS_CONNECTION_STRING=${AZURE_SERVICE_BUS_CONNECTION_STRING}
      # Blob Storage Tests
      - AZURE_STORAGE_CONNECTION_STRING=${AZURE_STORAGE_CONNECTION_STRING}
      # Container Apps / ACR
      - AZURE_CONTAINER_REGISTRY=${AZURE_CONTAINER_REGISTRY}
      # Static Web App / Vercel E2E
      - STATIC_WEB_APP_URL=${STATIC_WEB_APP_URL}
    volumes:
      - jenkins_home:/var/jenkins_home
      # Optional: allow Jenkins to use host Docker daemon for Docker builds
      - /var/run/docker.sock:/var/run/docker.sock

volumes:
  jenkins_home:
    driver: local


